<!DOCTYPE html>
<html lang="en">
		<head>
		<title>three.js Lab</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
body {
	font-family: Monospace;
	background-color: #111111;
	margin: 0px;
	overflow: hidden;
	background: #444444; /* Old browsers */
	background: -moz-radial-gradient(center, ellipse cover, #444444 0%, #111111 100%); /* FF3.6+ */
	background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%, #444444), color-stop(100%, #111111)); /* Chrome,Safari4+ */
	background: -webkit-radial-gradient(center, ellipse cover, #444444 0%, #111111 100%); /* Chrome10+,Safari5.1+ */
	background: -o-radial-gradient(center, ellipse cover, #444444 0%, #111111 100%); /* Opera 12+ */
	background: -ms-radial-gradient(center, ellipse cover, #444444 0%, #111111 100%); /* IE10+ */
	background: radial-gradient(ellipse at center, #444444 0%, #111111 100%); /* W3C */
 filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#444444', endColorstr='#111111', GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
}
</style>
		</head>
		<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
<script src="assets/js/three.min.js"></script> 
<script src="assets/js/controls/OrbitControls.js"></script> 
<script src="assets/js/Detector.js"></script> 
<script src="assets/js/stats.min.js"></script> 
<script src="assets/js/tween.min.js"></script> 
<!--<script src="mrdoob-three.js-cc57273/examples/js/shaders/BokehShader.js"></script>--> 

<script>

			var container, stats;
			var camera, scene, projector, renderer, controls;
			var clickobjects = [];
			var hoverobjects = [];
			var sprites = [];

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.z = 450;
				
				//////////////////////////////////
				//////// ORBIT CONTROLS //////////
				//////////////////////////////////
				
				controls = new THREE.OrbitControls( camera );
				controls.addEventListener( 'change', render );
				controls.maxPolarAngle = Math.PI/2.5; 
				controls.minDistance = 120;
				controls.maxDistance = 300;

				scene = new THREE.Scene();
				scene.fog = new THREE.FogExp2( 0x444444, 0.004 );
				
				//////////////////////////////////
				/////////// GEOMETRY /////////////
				//////////////////////////////////
				
				loader = new THREE.JSONLoader();
		
				loader.load( "assets/models/citybuildings.js", function( geometry ) {
				
					section1 = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial({
							specular: '#ccc',
							color: '#999',
							emissive: '#222',
							shininess: 100 
						  }));
					section1.scale.set( 0.7, 0.7, 0.7 );
					section1.position.set( -70, 0, 70 );
					scene.add( section1 );
					
					section2 = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial({
							specular: '#ccc',
							color: '#999',
							emissive: '#222',
							shininess: 100 
						  }));
					section2.scale.set( 0.7, 0.7, 0.7 );
					section2.position.set( 70, 0, 70 );
					scene.add( section2 );
					
					section3 = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial({
							specular: '#ccc',
							color: '#999',
							emissive: '#222',
							shininess: 100 
						  }));
					section3.scale.set( 0.7, 0.7, 0.7 );
					section3.position.set( 70, 0, -70 );
					scene.add( section3 );
					
					section4 = new THREE.Mesh( geometry, new THREE.MeshPhongMaterial({
							specular: '#ccc',
							color: '#999',
							emissive: '#222',
							shininess: 100 
						  }));
					section4.scale.set( 0.7, 0.7, 0.7 );
					section4.position.set( -70, 0, -70 );
					scene.add( section4 );
					
					clickobjects.push( section1, section2, section3, section4 );
					hoverobjects.push( section1, section2, section3, section4 );
				} );

				
				//////////////////////////////////
				//////////// SPRITES /////////////
				//////////////////////////////////

				sprite1 = makeTextSprite( " Section 1 ", 
					{ fontsize: 12, fontface: "Arial", borderColor: {r:0, g:0, b:0, a:1.0} } );
				sprite1.position.set(-70,60,70);
				scene.add( sprite1 );
				
				sprite2 = makeTextSprite( " Section 2 ", 
					{ fontsize: 12, fontface: "Arial", borderColor: {r:0, g:0, b:0, a:1.0} } );
				sprite2.position.set(70,60,70);
				scene.add( sprite2 );
				
				sprite3 = makeTextSprite( " Section 3 ", 
					{ fontsize: 12, fontface: "Arial", borderColor: {r:0, g:0, b:0, a:1.0} } );
				sprite3.position.set(70,60,-70);
				scene.add( sprite3 );
				
				sprite4 = makeTextSprite( " Section 4 ", 
					{ fontsize: 12, fontface: "Arial", borderColor: {r:0, g:0, b:0, a:1.0} } );
				sprite4.position.set(-70,60,-70);
				scene.add( sprite4 );
				
				sprites.push( sprite1, sprite2, sprite3, sprite4 );
				
				
				//////////////////////////////////
				/////////// LIGHTS ///////////////
				//////////////////////////////////
				
				var ambientLight = new THREE.AmbientLight(0x999999);
			    scene.add(ambientLight);
			  
			    // directional lighting
			    var light = new THREE.DirectionalLight(0xcccccc);
			    light.position.set(10, 200, 0).normalize();
			    scene.add(light);
				
				
				//////////////////////////////////
				/////////// RENDERER /////////////
				//////////////////////////////////

				projector = new THREE.Projector();

				renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild( stats.domElement );

				document.addEventListener( 'mouseup', onDocumentMouseUp, false );
				document.addEventListener( 'mousemove', onDocumentMouseMove, false );

				//

				window.addEventListener( 'resize', onWindowResize, false );

			}
			
			//////////////////////////////////
			///////// SPRITE BUILDER /////////
			//////////////////////////////////
			
			function makeTextSprite( message, parameters )
			{
				if ( parameters === undefined ) parameters = {};
				
				var fontface = parameters.hasOwnProperty("fontface") ? 
					parameters["fontface"] : "Arial";
				
				var fontsize = parameters.hasOwnProperty("fontsize") ? 
					parameters["fontsize"] : 18;
				
				var borderThickness = parameters.hasOwnProperty("borderThickness") ? 
					parameters["borderThickness"] : 1;
				
				var borderColor = parameters.hasOwnProperty("borderColor") ?
					parameters["borderColor"] : { r:0, g:0, b:0, a:1.0 };
				
				var backgroundColor = parameters.hasOwnProperty("backgroundColor") ?
					parameters["backgroundColor"] : { r:255, g:255, b:255, a:1.0 };
			
				var spriteAlignment = THREE.SpriteAlignment.topLeft;
					
				var canvas = document.createElement('canvas');
				var context = canvas.getContext('2d');
				context.font = fontsize + "px " + fontface;
				
				// get size data (height depends only on font size)
				var metrics = context.measureText( message );
				var textWidth = metrics.width;
				
				// background color
				context.fillStyle   = "rgba(" + backgroundColor.r + "," + backgroundColor.g + ","
											  + backgroundColor.b + "," + backgroundColor.a + ")";
				// border color
				context.strokeStyle = "rgba(" + borderColor.r + "," + borderColor.g + ","
											  + borderColor.b + "," + borderColor.a + ")";
			
				context.lineWidth = borderThickness;
				roundRect(context, borderThickness/2, borderThickness/2, textWidth + borderThickness, fontsize * 1.4 + borderThickness, 6);
				// 1.4 is extra height factor for text below baseline: g,j,p,q.
				
				// text color
				context.fillStyle = "rgba(0, 0, 0, 1.0)";
			
				context.fillText( message, borderThickness, fontsize + borderThickness);
				
				// canvas contents will be used for a texture
				var texture = new THREE.Texture(canvas) 
				texture.needsUpdate = true;
			
				var spriteMaterial = new THREE.SpriteMaterial( 
					{ map: texture, useScreenCoordinates: false, alignment: spriteAlignment } );
				var sprite = new THREE.Sprite( spriteMaterial );
				sprite.scale.set(100,50,1.0);
				return sprite;	
			}
			
			//////////////////////////////////
			//////// ROUND RECTANGLES ////////
			//////////////////////////////////
			
			function roundRect(ctx, x, y, w, h, r) 
			{
				ctx.beginPath();
				ctx.moveTo(x+r, y);
				ctx.lineTo(x+w-r, y);
				ctx.quadraticCurveTo(x+w, y, x+w, y+r);
				ctx.lineTo(x+w, y+h-r);
				ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
				ctx.lineTo(x+r, y+h);
				ctx.quadraticCurveTo(x, y+h, x, y+h-r);
				ctx.lineTo(x, y+r);
				ctx.quadraticCurveTo(x, y, x+r, y);
				ctx.closePath();
				ctx.fill();
				ctx.stroke();   
			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}
			
			//////////////////////////////////
			////////// CLICK EVENT ///////////
			//////////////////////////////////

			function onDocumentMouseUp( event ) {

				event.preventDefault();

				var vector = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1, 0.5 );
				projector.unprojectVector( vector, camera );

				var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

				var intersects = raycaster.intersectObjects( clickobjects );

				if ( intersects ) {
					if ( intersects[0] ){
						
						var time = 2000;
						new TWEEN.Tween( intersects[ 0 ].object.position ).to( {
							y: 20 }, time )
						.easing( TWEEN.Easing.Quadratic.InOut).start();
						
						if ( intersects[0].object.id == clickobjects[0].id ){
							new TWEEN.Tween( sprites[0].position ).to( {
								y: 80 }, time )
							.easing( TWEEN.Easing.Quadratic.InOut).start();
							new TWEEN.Tween( camera.position ).to( {
							x: intersects[0].object.position.x + 100,
							z: intersects[0].object.position.z + 150 }, time )
						.easing( TWEEN.Easing.Quadratic.InOut).start();
						} else if ( intersects[0].object.id == clickobjects[1].id ){
							new TWEEN.Tween( sprites[1].position ).to( {
								y: 80 }, time )
							.easing( TWEEN.Easing.Quadratic.InOut).start();
							new TWEEN.Tween( camera.position ).to( {
							x: intersects[0].object.position.x - 100,
							z: intersects[0].object.position.z + 150 }, time )
						.easing( TWEEN.Easing.Quadratic.InOut).start();
						}
						else if ( intersects[0].object.id == clickobjects[2].id ){
							new TWEEN.Tween( sprites[2].position ).to( {
								y: 80 }, time )
							.easing( TWEEN.Easing.Quadratic.InOut).start();
							new TWEEN.Tween( camera.position ).to( {
							x: intersects[0].object.position.x - 100,
							z: intersects[0].object.position.z + 150 }, time )
						.easing( TWEEN.Easing.Quadratic.InOut).start();
						}
						else if ( intersects[0].object.id == clickobjects[3].id ){
							new TWEEN.Tween( sprites[3].position ).to( {
								y: 80 }, time )
							.easing( TWEEN.Easing.Quadratic.InOut).start();
							new TWEEN.Tween( camera.position ).to( {
							x: intersects[0].object.position.x + 100,
							z: intersects[0].object.position.z + 150 }, time )
						.easing( TWEEN.Easing.Quadratic.InOut).start();
						}
						
						new TWEEN.Tween( controls.center ).to( {
							x: intersects[0].object.position.x,
							y: 20,
							z: intersects[0].object.position.z }, time )
						.easing( TWEEN.Easing.Quadratic.InOut).start();
						
					} else if ( intersects[0].object.id == clickobjects[1].id ){
						new TWEEN.Tween( camera.position ).to( {
							x: 0,
							y: 200,
							z: 0 }, 3000 )
						.easing( TWEEN.Easing.Exponential.InOut).start();
					}
				}
			}
			
			//////////////////////////////////
			//////// MOUSEMOVE EVENT /////////
			//////////////////////////////////
			
			function onDocumentMouseMove( event ) {

				event.preventDefault();

				var vector = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1, 0.5 );
				projector.unprojectVector( vector, camera );

				var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

				var intersects = raycaster.intersectObjects( hoverobjects );

				if (intersects[ 0 ]) {
					//intersects[ 0 ].object.material.color.setHex( 0xcc0000 );
					$('canvas').css('cursor','pointer')
					
				}else{
					$('canvas').css('cursor','auto')
					//for (var i=0;i<hoverobjects.length;i++){ 
						//hoverobjects[ i ].material.color.setHex( 0xffffff );}
				}
				
				
				
			}
			
			//

			function animate() {
				
				TWEEN.update();
				requestAnimationFrame( animate );
				controls.update();
				
				render();
				stats.update();
				
			}


			function render() {
				
				renderer.render( scene, camera );

			}

		</script>
</body>
</html>
